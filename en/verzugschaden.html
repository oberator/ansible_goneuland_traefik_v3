<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Delay Damage</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-6">

    <div class="bg-white shadow-lg rounded-lg p-6 text-center max-w-lg w-full">
        <p class="text-red-600 font-bold text-lg mb-4">To be filled out by the dispatch department only!</p>

        <h1 class="text-2xl font-bold mb-4">Report Delay Damage</h1>
        <form id="verzugForm" enctype="multipart/form-data">

            <label class="block text-left font-semibold mt-4">Order Number *</label>
            <input type="text" id="auftragsnummer" name="order_number" class="w-full p-2 border border-gray-300 rounded-lg" required>

            <label class="block text-left font-semibold mt-4">Date *</label>
            <input type="date" id="datum" name="date" class="w-full p-2 border border-gray-300 rounded-lg" required>

            <label class="block text-left font-semibold mt-4">Location *</label>
            <input type="text" id="ort" name="location" class="w-full p-2 border border-gray-300 rounded-lg" required>

            <label class="block text-left font-semibold mt-4">Planned Date *</label>
            <input type="datetime-local" id="solltermin" name="planned_date" class="w-full p-2 border border-gray-300 rounded-lg" required>

            <label class="block text-left font-semibold mt-4">Actual Date *</label>
            <input type="datetime-local" id="isttermin" name="actual_date" class="w-full p-2 border border-gray-300 rounded-lg" required>

            <label class="block text-left font-semibold mt-4">Photo of Delivery Note (at least 1 file) *</label>
            <input type="file" id="lieferschein" name="attachments[]" accept="image/jpeg, image/png" multiple class="w-full p-2 border border-gray-300 rounded-lg" >

            <label class="block text-left font-semibold mt-4">Reason for Delay *</label>
            <textarea id="grund" name="delay_reason" class="w-full p-2 border border-gray-300 rounded-lg" rows="3" required></textarea>

            <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg w-full mt-6">
                Verzugsschaden melden
            </button>
            <p class="text-red-600 mt-4" id="statusMessage"></p>
        </form>

        <a href="../index.php" class="mt-6 inline-block bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg transition">
            Zur&uuml;ck zur Hauptseite
        </a>
    </div>

    <script>
        document.getElementById('verzugForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const form = document.getElementById('verzugForm');
            const formData = new FormData(form);

            try {
                const response = await fetch('../send_verzug.php', {
                    method: 'POST',
                    body: formData
                });

                let result;
                try {
                    result = await response.json();
                } catch (error) {
                    throw new Error("Ungültige JSON-Antwort vom Server.");
                }

                if (result.status === 'success') {
                    document.getElementById('statusMessage').textContent = "✅ Verzugsschaden erfolgreich gemeldet!";
                    document.getElementById('statusMessage').style.color = "green";
                    form.reset();
                } else {
                    document.getElementById('statusMessage').textContent = "❌ Fehler: " + result.message;
                    document.getElementById('statusMessage').style.color = "red";
                }
            } catch (error) {
                document.getElementById('statusMessage').textContent = "❌ Fehler beim Senden der Anfrage: " + error.message;
                document.getElementById('statusMessage').style.color = "red";
            }
        });
    </script>

</body>
</html>